<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script>
    const TLP_SUPABASE_URL = 'https://gwjtfcrgpxclixonogpe.supabase.co';
    const TLP_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3anRmY3JncHhjbGl4b25vZ3BlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMzQzOTUsImV4cCI6MjA4NTkxMDM5NX0.qM1-_VA1Dsx_nsWkeoAJvNWNgSuuwApPBGoJU32X3-I';
    const APP_NAME = 'build_lead';
    window.CloudSync = { online: navigator.onLine, async save(k,d) { localStorage.setItem(APP_NAME+"_"+k, JSON.stringify(d)); if(!this.online)return{synced:false}; try{const e=await fetch(TLP_SUPABASE_URL+"/rest/v1/app_data?app_data=eq."+APP_NAME+"&data_key=eq."+k+"&select=id",{headers:{"apikey":TLP_SUPABASE_KEY,"Authorization":"Bearer "+TLP_SUPABASE_KEY}}).then(r=>r.json());const m=e.length>0?"PATCH":"POST";const u=e.length>0?TLP_SUPABASE_URL+"/rest/v1/app_data?id=eq."+e[0].id:TLP_SUPABASE_URL+"/rest/v1/app_data";await fetch(u,{method:m,headers:{"apikey":TLP_SUPABASE_KEY,"Authorization":"Bearer "+TLP_SUPABASE_KEY,"Content-Type":"application/json"},body:JSON.stringify(e.length>0?{data:d}:{app_data:APP_NAME,data_key:k,data:d})});return{synced:true};}catch(x){return{synced:false};}}, async load(k){if(this.online){try{const r=await fetch(TLP_SUPABASE_URL+"/rest/v1/app_data?app_data=eq."+APP_NAME+"&data_key=eq."+k+"&select=data",{headers:{"apikey":TLP_SUPABASE_KEY,"Authorization":"Bearer "+TLP_SUPABASE_KEY}}).then(r=>r.json());if(r.length>0){localStorage.setItem(APP_NAME+"_"+k,JSON.stringify(r[0].data));return r[0].data;}}catch(x){}}const l=localStorage.getItem(APP_NAME+"_"+k);return l?JSON.parse(l):null;}};
    window.addEventListener("online",()=>CloudSync.online=true);window.addEventListener("offline",()=>CloudSync.online=false);
  </script>
  <!-- Unified Cloud Sync -->
    <script src="https://thelightparkops.com/shared/cloud-sync.js"></script>
  <script src="https://thelightparkops.com/shared/auth.js"></script>
  <script src="https://thelightparkops.com/shared/permissions.js"></script>
    <title>Build Lead | The Light Park</title>
  <style>
    :root {
      --bg: #0B0D14;
      --surface: #12151F;
      --surface2: #1a1e2e;
      --border: #2a2f42;
      --text: #f0f0f5;
      --text-dim: #8888a0;
      --purple: #a855f7;
      --teal: #06d6a0;
      --pink: #ff4fd8;
      --green: #22c55e;
      --orange: #f97316;
      --blue: #3b82f6;
      --red: #ef4444;
      --yellow: #eab308;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    
    /* Splash */
    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s;
    }
    #splash.hidden { opacity: 0; pointer-events: none; }
    #splash img {
      max-width: 85%;
      max-height: 30vh;
      animation: pulse-glow 2s ease-in-out infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { filter: drop-shadow(0 8px 32px rgba(249, 115, 22, 0.4)); }
      50% { filter: drop-shadow(0 8px 48px rgba(234, 179, 8, 0.6)); }
    }
    
    .header {
      background: linear-gradient(135deg, var(--orange), var(--red));
      padding: 20px;
    }
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .header h1 { font-size: 24px; font-weight: 800; }
    .venue-select {
      padding: 10px 16px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      color: white;
      font-size: 14px;
    }
    .progress-bar {
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      height: 20px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 10px;
      font-size: 12px;
      font-weight: 700;
      color: var(--orange);
    }
    .progress-label {
      text-align: center;
      margin-top: 8px;
      font-size: 14px;
      opacity: 0.9;
    }
    
    .container { padding: 20px; }
    
    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    .stat-value { font-size: 28px; font-weight: 800; }
    .stat-label { font-size: 11px; color: var(--text-dim); margin-top: 4px; }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 20px;
      background: var(--surface);
      padding: 4px;
      border-radius: 10px;
    }
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-dim);
      transition: all 0.2s;
    }
    .tab:hover { color: var(--text); }
    .tab.active {
      background: var(--purple);
      color: white;
    }
    
    /* Section */
    .section { margin-bottom: 24px; }
    .section-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Today's Mission */
    .mission-card {
      background: linear-gradient(135deg, var(--surface), var(--surface2));
      border: 2px solid var(--purple);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }
    .mission-title {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 8px;
      color: var(--purple);
    }
    .mission-desc { color: var(--text-dim); margin-bottom: 16px; }
    .mission-goals {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }
    .goal-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--surface);
      border-radius: 8px;
    }
    .goal-check {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .goal-check.done {
      background: var(--green);
      border-color: var(--green);
      color: white;
    }
    .goal-text { font-size: 14px; }
    .goal-text.done { text-decoration: line-through; color: var(--text-dim); }
    
    /* Zone List */
    .zone-list { display: flex; flex-direction: column; gap: 12px; }
    .zone-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .zone-icon { font-size: 32px; }
    .zone-info { flex: 1; }
    .zone-name { font-weight: 700; font-size: 15px; }
    .zone-detail { font-size: 12px; color: var(--text-dim); }
    .zone-progress {
      width: 120px;
      text-align: right;
    }
    .zone-pct { font-size: 24px; font-weight: 800; }
    .zone-bar {
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      margin-top: 6px;
      overflow: hidden;
    }
    .zone-bar-fill { height: 100%; background: var(--green); }
    
    /* Crew List */
    .crew-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
    }
    .crew-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    .crew-avatar {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--purple), var(--teal));
      border-radius: 50%;
      margin: 0 auto 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
    }
    .crew-name { font-weight: 700; font-size: 14px; }
    .crew-role { font-size: 12px; color: var(--text-dim); }
    .crew-task {
      margin-top: 8px;
      padding: 6px 10px;
      background: var(--surface2);
      border-radius: 6px;
      font-size: 11px;
    }
    
    /* Issues */
    .issue-item {
      display: flex;
      gap: 12px;
      padding: 14px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .issue-priority {
      width: 4px;
      border-radius: 2px;
    }
    .issue-high { background: var(--red); }
    .issue-medium { background: var(--orange); }
    .issue-low { background: var(--yellow); }
    .issue-content { flex: 1; }
    .issue-title { font-weight: 600; font-size: 14px; }
    .issue-meta { font-size: 12px; color: var(--text-dim); }
    
    .btn {
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      font-size: 13px;
    }
    .btn-primary { background: var(--purple); color: white; }
    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }
    
    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .tabs { flex-wrap: wrap; }
      .tab { flex: none; width: calc(50% - 2px); }
    }
  </style>
</head>
<body>
  <!-- Splash -->
  <div id="splash">
    <img src="logo.jpg" alt="The Light Park Build Lead">
  </div>
  
  <div class="header">
    <div class="header-top">
      <h1>üèóÔ∏è Build Lead</h1>
      <select class="venue-select" id="venueSelect">
        <option value="katy">üìç Katy</option>
        <option value="spring">üìç Spring</option>
        <option value="selma">üìç Selma</option>
      </select>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" style="width: 67%;">67%</div>
    </div>
    <div class="progress-label">Build Progress: Day 8 of 12</div>
  </div>
  
  <div class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" style="color: var(--green);">156</div>
        <div class="stat-label">Props Installed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color: var(--orange);">84</div>
        <div class="stat-label">Remaining</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color: var(--purple);">12</div>
        <div class="stat-label">Crew On-Site</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color: var(--teal);">4</div>
        <div class="stat-label">Days Left</div>
      </div>
    </div>
    
    <div class="tabs">
      <div class="tab active" onclick="showTab('mission')">üéØ Today</div>
      <div class="tab" onclick="showTab('zones')">üìç Zones</div>
      <div class="tab" onclick="showTab('crew')">üë∑ Crew</div>
      <div class="tab" onclick="showTab('issues')">‚ö†Ô∏è Issues</div>
    </div>
    
    <!-- Today Tab -->
    <div id="tab-mission" class="tab-content">
      <div class="mission-card">
        <div class="mission-title">üéØ Today's Mission</div>
        <div class="mission-desc">Complete Gnome Village + Start RGB Tunnel installation</div>
        <div class="mission-goals">
          <div class="goal-item">
            <div class="goal-check done" onclick="toggleGoal(this)">‚úì</div>
            <span class="goal-text done">Morning crew briefing</span>
          </div>
          <div class="goal-item">
            <div class="goal-check done" onclick="toggleGoal(this)">‚úì</div>
            <span class="goal-text done">Finish Gnome B section (6 units)</span>
          </div>
          <div class="goal-item">
            <div class="goal-check" onclick="toggleGoal(this)"></div>
            <span class="goal-text">Start RGB Tunnel frame assembly</span>
          </div>
          <div class="goal-item">
            <div class="goal-check" onclick="toggleGoal(this)"></div>
            <span class="goal-text">Wire RGB Tunnel power (100A circuit)</span>
          </div>
          <div class="goal-item">
            <div class="goal-check" onclick="toggleGoal(this)"></div>
            <span class="goal-text">Test Gnome Village full sequence</span>
          </div>
          <div class="goal-item">
            <div class="goal-check" onclick="toggleGoal(this)"></div>
            <span class="goal-text">End of day safety walk</span>
          </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">üìã Zone Status</div>
        <div class="zone-list">
          <div class="zone-card">
            <div class="zone-icon">üéÑ</div>
            <div class="zone-info">
              <div class="zone-name">Mega Tree Plaza</div>
              <div class="zone-detail">32/32 props ‚Ä¢ Power tested ‚úì</div>
            </div>
            <div class="zone-progress">
              <div class="zone-pct" style="color:var(--green);">100%</div>
              <div class="zone-bar"><div class="zone-bar-fill" style="width:100%"></div></div>
            </div>
          </div>
          <div class="zone-card">
            <div class="zone-icon">üßù</div>
            <div class="zone-info">
              <div class="zone-name">Gnome Village</div>
              <div class="zone-detail">20/24 props ‚Ä¢ 4 remaining today</div>
            </div>
            <div class="zone-progress">
              <div class="zone-pct" style="color:var(--orange);">83%</div>
              <div class="zone-bar"><div class="zone-bar-fill" style="width:83%"></div></div>
            </div>
          </div>
          <div class="zone-card">
            <div class="zone-icon">üåà</div>
            <div class="zone-info">
              <div class="zone-name">RGB Tunnel</div>
              <div class="zone-detail">Starting today ‚Ä¢ 48 props total</div>
            </div>
            <div class="zone-progress">
              <div class="zone-pct" style="color:var(--red);">0%</div>
              <div class="zone-bar"><div class="zone-bar-fill" style="width:0%"></div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Zones Tab -->
    <div id="tab-zones" class="tab-content" style="display:none;">
      <div class="zone-list">
        <div class="zone-card">
          <div class="zone-icon">üéÑ</div>
          <div class="zone-info">
            <div class="zone-name">Mega Tree Plaza</div>
            <div class="zone-detail">32 props ‚Ä¢ Zone A</div>
          </div>
          <div class="zone-progress">
            <div class="zone-pct" style="color:var(--green);">100%</div>
          </div>
        </div>
        <div class="zone-card">
          <div class="zone-icon">üßù</div>
          <div class="zone-info">
            <div class="zone-name">Gnome Village</div>
            <div class="zone-detail">24 props ‚Ä¢ Zone B</div>
          </div>
          <div class="zone-progress">
            <div class="zone-pct" style="color:var(--orange);">83%</div>
          </div>
        </div>
        <div class="zone-card">
          <div class="zone-icon">üåà</div>
          <div class="zone-info">
            <div class="zone-name">RGB Tunnel</div>
            <div class="zone-detail">48 props ‚Ä¢ Zone C</div>
          </div>
          <div class="zone-progress">
            <div class="zone-pct" style="color:var(--red);">0%</div>
          </div>
        </div>
        <div class="zone-card">
          <div class="zone-icon">üéÖ</div>
          <div class="zone-info">
            <div class="zone-name">Santa's Workshop</div>
            <div class="zone-detail">36 props ‚Ä¢ Zone D</div>
          </div>
          <div class="zone-progress">
            <div class="zone-pct" style="color:var(--yellow);">50%</div>
          </div>
        </div>
        <div class="zone-card">
          <div class="zone-icon">‚ùÑÔ∏è</div>
          <div class="zone-info">
            <div class="zone-name">Winter Wonderland</div>
            <div class="zone-detail">44 props ‚Ä¢ Zone E</div>
          </div>
          <div class="zone-progress">
            <div class="zone-pct" style="color:var(--yellow);">25%</div>
          </div>
        </div>
        <div class="zone-card">
          <div class="zone-icon">ü¶å</div>
          <div class="zone-info">
            <div class="zone-name">Reindeer Run</div>
            <div class="zone-detail">28 props ‚Ä¢ Zone F</div>
          </div>
          <div class="zone-progress">
            <div class="zone-pct" style="color:var(--text-dim);">0%</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Crew Tab -->
    <div id="tab-crew" class="tab-content" style="display:none;">
      <div class="crew-grid">
        <div class="crew-card">
          <div class="crew-avatar">JM</div>
          <div class="crew-name">Jake Martinez</div>
          <div class="crew-role">Build Lead</div>
          <div class="crew-task">üìç RGB Tunnel setup</div>
        </div>
        <div class="crew-card">
          <div class="crew-avatar">EM</div>
          <div class="crew-name">Eddie Morales</div>
          <div class="crew-role">Electrician</div>
          <div class="crew-task">‚ö° Tunnel power wiring</div>
        </div>
        <div class="crew-card">
          <div class="crew-avatar">SC</div>
          <div class="crew-name">Sarah Chen</div>
          <div class="crew-role">Install Tech</div>
          <div class="crew-task">üßù Gnome B finishing</div>
        </div>
        <div class="crew-card">
          <div class="crew-avatar">MR</div>
          <div class="crew-name">Mike Rodriguez</div>
          <div class="crew-role">Install Tech</div>
          <div class="crew-task">üßù Gnome B finishing</div>
        </div>
        <div class="crew-card">
          <div class="crew-avatar">TB</div>
          <div class="crew-name">Tyler Brown</div>
          <div class="crew-role">Network Tech</div>
          <div class="crew-task">üì° WiFi mesh setup</div>
        </div>
        <div class="crew-card">
          <div class="crew-avatar">AL</div>
          <div class="crew-name">Ana Lopez</div>
          <div class="crew-role">Install Tech</div>
          <div class="crew-task">üéÖ Workshop prep</div>
        </div>
      </div>
    </div>
    
    <!-- Issues Tab -->
    <div id="tab-issues" class="tab-content" style="display:none;">
      <div class="issue-item">
        <div class="issue-priority issue-high"></div>
        <div class="issue-content">
          <div class="issue-title">RGB Tunnel power drop missing</div>
          <div class="issue-meta">Need 100A circuit ‚Ä¢ Electrician requested</div>
        </div>
        <button class="btn btn-outline">Escalate</button>
      </div>
      <div class="issue-item">
        <div class="issue-priority issue-medium"></div>
        <div class="issue-content">
          <div class="issue-title">Gnome B #7 controller DOA</div>
          <div class="issue-meta">Replacement ordered ‚Ä¢ ETA tomorrow</div>
        </div>
        <button class="btn btn-outline">Update</button>
      </div>
      <div class="issue-item">
        <div class="issue-priority issue-low"></div>
        <div class="issue-content">
          <div class="issue-title">Extra stakes needed for Zone E</div>
          <div class="issue-meta">Added to next supply run</div>
        </div>
        <button class="btn btn-outline">Done</button>
      </div>
      <button class="btn btn-primary" style="width:100%; margin-top:16px;">‚ûï Report Issue</button>
    </div>
  </div>
  
  <script>
    // Build progress tracking
    let buildProgress = [];
    let employees = [];
    
    // Get current venue
    function getCurrentVenue() {
      const select = document.querySelector('.venue-select');
      return select ? select.value : 'Pearland';
    }
    
    // Initialize
    async function init() {
      await loadEmployees();
      await loadProgress();
      renderProgress();
    }
    
    // Load employees from shared Employee App
    async function loadEmployees() {
      if (!window.TLPStaffSync) return;
      
      try {
        const allEmployees = await TLPStaffSync.getStaff() || [];
        // Filter for build roles
        employees = allEmployees.filter(e => 
          ['Build Lead', 'Install Tech', 'Electrician', 'Network Tech'].some(role => 
            e.role.toLowerCase().includes(role.toLowerCase())
          )
        );
        console.log('[Build Lead] Loaded', employees.length, 'build crew from Employee App');
      } catch (e) {
        console.error('[Build Lead] Could not load employees:', e);
      }
    }
    
    // Load build progress from cloud
    async function loadProgress() {
      if (!window.TLPBuildSync) {
        const local = localStorage.getItem('tlp_build-progress');
        if (local) {
          buildProgress = JSON.parse(local);
        }
        return;
      }
      
      try {
        buildProgress = await TLPBuildSync.getProgress() || [];
        console.log('[Build Lead] Loaded', buildProgress.length, 'progress items');
      } catch (e) {
        console.error('[Build Lead] Could not load progress:', e);
      }
    }
    
    // Save build progress to cloud
    async function saveProgress() {
      // Save locally
      localStorage.setItem('tlp_build-progress', JSON.stringify(buildProgress));
      
      // Sync to cloud
      if (window.TLPBuildSync) {
        try {
          await TLPBuildSync.saveProgress(buildProgress);
          console.log('[Build Lead] ‚úì Progress synced to cloud');
        } catch (e) {
          console.error('[Build Lead] Sync failed:', e);
        }
      }
    }
    
    // Update zone progress
    function updateZoneProgress(zone, percentComplete, notes) {
      const existing = buildProgress.find(p => p.zone === zone && p.venue === getCurrentVenue());
      
      if (existing) {
        existing.percentComplete = percentComplete;
        existing.notes = notes || existing.notes;
        existing.updatedAt = new Date().toISOString();
      } else {
        buildProgress.push({
          id: Date.now().toString(36),
          venue: getCurrentVenue(),
          zone: zone,
          status: percentComplete === 100 ? 'complete' : 'in-progress',
          percentComplete: percentComplete,
          notes: notes || '',
          updatedAt: new Date().toISOString()
        });
      }
      
      saveProgress();
      renderProgress();
    }
    
    function renderProgress() {
      // Could update zone cards dynamically based on buildProgress
    }
    
    function showTab(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.getElementById(`tab-${tab}`).style.display = 'block';
      event.target.classList.add('active');
    }
    
    function toggleGoal(el) {
      el.classList.toggle('done');
      const text = el.nextElementSibling;
      text.classList.toggle('done');
      el.textContent = el.classList.contains('done') ? '‚úì' : '';
      
      // Could trigger progress update here
    }
    
    // Hide splash after 2s
    setTimeout(() => document.getElementById('splash').classList.add('hidden'), 2000);
    
    // Start
    init();
  </script>
</body>
</html>
